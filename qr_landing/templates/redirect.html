<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirigiendo...</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <meta http-equiv="refresh" content="3;url={{ redirect_url }}">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>¡Código QR Procesado!</h1>
            <p class="subtitle">Te estamos redirigiendo a tu destino</p>
        </header>

        <main class="main-content" style="text-align: center; padding: 60px 20px;">
            <div class="redirect-info">
                <div class="success-icon" style="font-size: 4em; color: #10b981; margin-bottom: 30px;">
                    ✓
                </div>
                
                <h2 style="color: #374151; margin-bottom: 20px;">Redirección Exitosa</h2>
                
                <p style="color: #6b7280; margin-bottom: 30px; font-size: 1.1em;">
                    Serás redirigido automáticamente en <span id="countdown">3</span> segundos
                </p>
                
                <div style="background: #f3f4f6; padding: 20px; border-radius: 10px; margin: 30px 0;">
                    <p style="color: #374151; margin-bottom: 10px; font-weight: 600;">Destino:</p>
                    <p style="color: #4f46e5; word-break: break-all; font-size: 0.9em;">{{ redirect_url }}</p>
                </div>
                
                <div class="redirect-actions">
                    <a href="{{ redirect_url }}" class="btn btn-primary" style="margin-right: 15px;">
                        Ir Ahora
                    </a>
                    <a href="{{ url_for('index') }}" class="btn btn-secondary">
                        Escanear Otro QR
                    </a>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Contador regresivo
        let timeLeft = 3;
        const countdownElement = document.getElementById('countdown');
        
        const timer = setInterval(function() {
            timeLeft--;
            countdownElement.textContent = timeLeft;
            
            if (timeLeft <= 0) {
                clearInterval(timer);
                countdownElement.textContent = "0";
            }
        }, 1000);
        
        // Prevenir que la página se quede en blanco si hay algún error
        setTimeout(function() {
            if (window.location.href.indexOf('{{ redirect_url }}') === -1) {
                window.location.href = '{{ redirect_url }}';
            }
        }, 3500);

        // Registrar estadística (opcional - para analytics)
        fetch('/track-redirect', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                destination: '{{ redirect_url }}',
                timestamp: new Date().toISOString()
            })
        }).catch(err => console.log('Analytics tracking failed:', err));
    </script>
</body>
</html>